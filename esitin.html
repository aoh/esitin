<html>
<head>

<style>

   @keyframes fade {
      0% { opacity: 0; }
      100% { opacity: 1; display: block; }
   }
   
   @keyframes fadeout {
      0% { opacity: 1; }
      100% { opacity: 0; }
   }
   
   @keyframes fade2 {
      0% { opacity: 0; }
      50% { opacity: 0; }
      100% { opacity: 1; display: block; }
   }
   
   body {
      background: #000000;
      color: #ffffff;
      cursor: url(pic/cursor.png), none !important;
   }

   div {
      height: 97%;
      text-align: center;
   }
   
   .mid {
      //border: solid red 10px;
   }
   
   span {
      margin-top: 20%;
      display: inline-block;
      vertical-align: middle;
      line-height: normal;
   }
   
   img {
      display: block;
      margin-left: auto;
      margin-right: auto;
      animation: fade 0.2s;
   }
   
   h1 {
      color: #eeeeee;
      //text-shadow: 9px 6px 29px #4f4f4f, 3px 2px 0 #555555;
      text-shadow: 3px 2px 0 #555555;
      animation: fade 0.5s;
      font-size: 120px;
   }
  
   h2 {
      color: #eeeeee;
      //text-shadow: 9px 9px 15px #6f6f6f, 3px 2px 0 #555555;
      text-shadow: 2px 1.5px 0 #555555;
      font-size: 40px;
      animation: fade2 2s;
   }
   
</style>

<script>

   var dscreen;
   var pos;
   var data;

   var iwidth;
   var iheight;

   var left  = 37;
   var right = 39;
   var space = 32;
   var down  = 40;
   var up    = 38;
   
   function blit(content) {
      dscreen.innerHTML = content;
   }

   function min(a,b) {
      if (a < b) return a;
      return b;
   } 
  
  function max(a,b) { 
      if (a > b) return a;
      return b;
   }

   var slides = [

      "http://haltp.org/f/glide.png",
      "http://haltp.org/f/puut.jpg",
      "http://haltp.org/f/puu.jpeg",
      "Section I",
      "Section II",
      "Section III",
      "http://haltp.org/f/pi.jpg",
      "Fini"
      ];


   function slider(k) {
      console.log(k);
      if (k == left) {
         pos -= 1;
      } else if (k == right) {
         pos += 1;
      } else if (k == up) {
         pos += 5;
      } else if (k == down) {
         pos -= 5;
      }
      pos = max(0, min(pos, slides.length-1));
      data = slides[pos];
      update();
   }

   var nextpic;
   
   function imgblitter() {
      var tw = nextpic.width;
      var th = nextpic.height;
      var sw = iwidth;
      var sh = iheight;
      var zw, zh;
      var prev = document.getElementById("currentpic");
      if (prev) {
         var op = prev.style.opacity;
         if (!op) { op = "1.0"; }
         if (op < 0.01) {
            if (tw/th > sw/sh) {
               zw = sw;
               zh = zw * (th/tw);
               zp = (sh - zh) / 2
            } else {
               zh = sh;
               zw = Math.round(zh * (tw / th));
               zp = 0;
            }
            data = "<img id=\"currentpic\" style=\"padding-top: " + zp + "px\" width=" + zw + " height=" + zh + " src=\"" + nextpic.src + "\">";
            blit(data);
         } else {
            prev.style.opacity = String(max(0, op - 0.08));
            setTimeout(imgblitter, 10);
         }
      } else {
         if (tw/th > sw/sh) {
            zw = sw;
            zh = zw * (th/tw);
            zp = (sh - zh) / 2
         } else {
            zh = sh;
            zw = Math.round(zh * (tw / th));
            zp = 0;
         }
         data = "<img id=\"currentpic\" style=\"padding-top: " + zp + "px\" width=" + zw + " height=" + zh + " src=\"" + nextpic.src + "\">";
         blit(data);
      }
   }

   function imgfail() {
      console.log("Failed to load " + this.src);
      blit("failed to load " + nextpic.src);
   }
   
   
   function blitimage(path) {
      nextpic = new Image();
      nextpic.onload = imgblitter;
      nextpic.onerror = imgfail;
      nextpic.src = path;
   }

   function update() {
      if (data.match(/\.(jpg|gif|png|jpeg)$/i)) {
         blitimage(data);
      } else if (data.match(/</)) {
         blit("<div class=\"mid\"><span>" + data + "</span></div>");
      } else {
         blit("<div class=\"mid\"><span><h1>" + data + "</h1></span></div>");
      }
   }

   function keyhandler(e) {
      var keycode;
      if (window.event) {
         keycode = window.event.keyCode;
      } else {
         keycode = e.which;
      }
      slider(keycode);
   }

   function btnhandler(e) {
      console.log(e);
   }

   function main() {
      dscreen = document.getElementById("dscreen");
      data = "loading...";
      iwidth = document.body.clientWidth - 120;
      iheight = document.body.clientHeight - 40;
      //alert(dscreen);
      pos = 0;
      if (!dscreen) {
         alert("ERROR: no screen(s) found. Check /var/log/X11.log for details.");
      }
      document.onkeydown = keyhandler;
      document.onclick = function () {slider(left); return false; };
      document.oncontextmenu = function () {slider(right); return false; };
      window.onresize = function() { slider(32); };
      data = slides[pos];
      update();
   }

</script>

<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

</head>

<body onload="main()">

<div id="dscreen">
	loading
</div>

</body>

</html>
